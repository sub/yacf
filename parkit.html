<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="jquery.mobile-1.0a1.min.css" />
  <script src="scripts/phonegap.js"></script>
  <script src="scripts/jquery-1.4.3.min.js"></script>
  <script src="scripts/jquery.mobile-1.0a1.min.js"></script>
  <script src="scripts/Lawnchair.js"></script>
  <script src="scripts/LawnchairAdaptorHelpers.js"></script>
  <script src="scripts/DOMStorageAdaptor.js"></script>

  <script type="text/javascript">
    function loader() {
	var state = document.readyState;

	if (typeof(localStorage) == 'undefined' ) {
	    alert('Upgrade your browser as it does not support HTML5 localStorage.');
	} 

	if (state == 'loaded' || state == 'complete') {
	    getLocation();
	} else {
	    if (navigator.userAgent.indexOf('Browzr') > -1) {
		setTimeout(geoLocation, 250);
	    } else {
		document.addEventListener('deviceready',geoLocation,false);
	    }
        }
    }

    var getLocation = function() {
	var suc = function(p) {
	    parkIt(p);
	};
	var fail = function() {
	    alert("NOT ABLE TO GET THE CURRENT POSITION");
	};
	navigator.geolocation.getCurrentPosition(suc,fail);
    }

    function parkIt(p) {
	try {
            // create my Lawnchair stores
            var gpsstore = new Lawnchair({table: 'mygps', adaptor: 'dom'});
	    
            // save some data to my stores
            gpsstore.save({key:'destination', value:"home"});
            gpsstore.save({key:'latitude', value:p.coords.latitude});
            gpsstore.save({key:'longitude', value:p.coords.longitude});
	    
	    newtext = "Car parked @ lat " + p.coords.latitude + " long " + p.coords.longitude;
	    $('.content').text(newtext);
	} catch (e) {
	    if (e == QUOTA_EXCEEDED_ERR) {
		alert('Quota exceeded!');
	    }
	}
	
    }

</script>
    
</head>
    <body onload="loader()">
    
    <div data-role="page" data-theme="b" id="jqm-home"> 
      <div data-role="header">
        <h1>parkit!</h1>
      </div>
    
      <div data-role="content" class="content" align="center">       
        Please wait, storing your GPS pos.
      </div> 
    
      <div data-role="footer">
        <h4>@fitzkarraldo</h4>
      </div> 
    </div> 
   
 </body>
 
</html>
